---
import Header from "../components/Header.astro";
import TickerTape from "../components/TickerTape.astro";
import Footer from "../components/Footer.astro";
import "../styles/global.css";
import { loadQuery } from "../lib/load-query";
import type {
  TickerTapeType,
  HeaderType,
  FooterType,
  ServicesType,
  SeoFields,
} from "../lib/types";
import SEO from "../components/SEO.astro";

const { data: tickerItems } = await loadQuery<TickerTapeType>({
  query: `*[_type == "tickerTape"][0]`,
});

const { data: headerItems } = await loadQuery<HeaderType>({
  query: `*[_type == "header"][0]`,
});

const { data: footerItems } = await loadQuery<FooterType>({
  query: `*[_type == "footer"][0]`,
});

const { data: servicesItems } = await loadQuery<ServicesType[]>({
  query: `*[_type == "services"]{ name, slug }`,
});

interface Props {
  seo: SeoFields;
  siteUrl: string;
}

const { seo, siteUrl } = Astro.props;
---

<!doctype html>
<html lang="en">
  <SEO seo={seo} siteUrl={siteUrl} />
  <body>
    <Header {...headerItems} />
    {
      tickerItems.active && (
        <TickerTape
          title={tickerItems?.title}
          items={tickerItems?.tickerTapeItems}
        />
      )
    }
    <slot />
    <Footer {...footerItems} servicesColumn={servicesItems} />
  </body>
</html>

<style>
  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
  }
</style>
