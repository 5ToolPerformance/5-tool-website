---
import Layout from "../../layouts/Layout.astro";
import { loadQuery } from "../../lib/load-query";
import { urlForImage } from "../../lib/urlForImage";
import CoachCarousel from "../../components/CoachCarousel.astro";
import { getAllCoaches } from "../../lib/coachesHelper";
import ServicesCard from "../../components/cards/ServicesCard.astro";
import type { ServicesType } from "../../lib/types";
import { Image } from "astro:assets";
import type { AboutPageType } from "../../lib/types";

const { data: aboutPage } = await loadQuery<AboutPageType>({
  query: `*[_type == "aboutPage"][0]{
    ...,
    "content": {
      _type,
      _key,
      ...
    },
    "seo": {
      metaTitle,
      metaDescription,
      focusKeyword,
      canonicalUrl,
      openGraph{
        title,
        description,
        "image": image.asset->url,
        type
      },
      twitter{
        title,
        description,
        "image": image.asset->url,
        cardType
      },
      robots,
      schemaMarkup,
      seoAnalysis,
      additionalMeta
    }
  }`,
});

const bgImageUrl = aboutPage?.heroImage
  ? urlForImage(aboutPage.heroImage).url()
  : "";

const coaches = await getAllCoaches();

const { data: services } = await loadQuery<ServicesType[]>({
  query: `*[_type == "services"]`,
});
---

<Layout seo={aboutPage?.seo} siteUrl="https://www.5tool.com">
  <!-- Hero Section (minimal) -->
  <section class="w-full bg-white py-16">
    <div class="container mx-auto px-4">
      <div class="text-center">
        <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold text-navy">
          {aboutPage?.title || "About Us"}
        </h1>
        {
          aboutPage?.subtitle && (
            <p class="mt-3 text-lg sm:text-xl text-navy/80">
              {aboutPage.subtitle}
            </p>
          )
        }
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <main class="bg-white">
    <!-- Company Info Section (full-width split) -->
    <section class="w-full bg-carolina">
      <div class="flex flex-col md:flex-row w-full">
        <!-- Image on left -->
        {
          aboutPage?.companyImage && (
            <div class="w-full md:w-1/2">
              <Image
                src={urlForImage(aboutPage.companyImage).url()}
                alt={aboutPage.companyImage?.alt || "Company Image"}
                class="w-full h-full object-cover"
                loading="lazy"
                inferSize
              />
            </div>
          )
        }
        <!-- Content on right -->
        <div class="w-full md:w-1/2 p-8 md:p-16 flex items-center">
          <div class="max-w-2xl mx-auto">
            <h2 class="text-3xl md:text-4xl font-bold text-navy mb-6">
              Our Company
            </h2>
            {
              aboutPage?.companyInfo && (
                <p class="text-lg md:text-xl text-navy/90 leading-relaxed">
                  {aboutPage.companyInfo}
                </p>
              )
            }
          </div>
        </div>
      </div>
    </section>

    <!-- Facility Info Section (full-width split, image right) -->
    <section class="w-full bg-navy text-white">
      <div class="flex flex-col md:flex-row w-full">
        <!-- Content on left -->
        <div
          class="w-full md:w-1/2 p-8 md:p-16 flex items-center order-2 md:order-1"
        >
          <div class="max-w-2xl mx-auto">
            <h2 class="text-3xl md:text-4xl font-bold mb-6">Our Facility</h2>
            {
              aboutPage?.facilityInfo && (
                <p class="text-lg md:text-xl text-white/90 leading-relaxed">
                  {aboutPage.facilityInfo}
                </p>
              )
            }
          </div>
        </div>
        <!-- Image on right -->
        {
          aboutPage?.facilityImage && (
            <div class="w-full md:w-1/2 order-1 md:order-2">
              <Image
                src={urlForImage(aboutPage.facilityImage).url()}
                alt={aboutPage.facilityImage?.alt || "Facility Image"}
                class="w-full h-full object-cover"
                loading="lazy"
                inferSize
              />
            </div>
          )
        }
      </div>
    </section>
    <!-- Coaches Section -->
    <section class="relative py-8 sm:py-16 overflow-hidden bg-navy">
      <!-- Main content -->
      <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
          <h2
            class="text-3xl font-bold text-white sm:text-4xl md:text-5xl mb-4"
          >
            Meet Our Coaches
          </h2>
          <div class="w-20 h-1 bg-carolina-400 mx-auto mb-6"></div>
        </div>

        <CoachCarousel coaches={coaches} />
      </div>
    </section>
  </main>
</Layout>
